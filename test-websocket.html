<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <button onclick="testConnection()">Test WebSocket</button>
    <button onclick="disconnect()">Disconnect</button>
    <pre id="log"></pre>

    <script>
        let ws = null;
        const log = document.getElementById('log');
        
        function logMessage(msg) {
            console.log(msg);
            log.textContent += msg + '\n';
        }
        
        function testConnection() {
            const token = localStorage.getItem('token');
            if (!token) {
                logMessage('âŒ No token found in localStorage');
                return;
            }
            
            if (ws && (ws.readyState === WebSocket.CONNECTING || ws.readyState === WebSocket.OPEN)) {
                logMessage('âš ï¸ WebSocket already connecting or connected');
                return;
            }
            
            const wsUrl = 'wss://api.leema.kz/ws/shop';
            logMessage(`ğŸ”„ Connecting to: ${wsUrl}`);
            
            try {
                ws = new WebSocket(`${wsUrl}?token=${token}`);
                
                ws.onopen = (event) => {
                    logMessage(`âœ… Connected! ReadyState: ${ws.readyState}`);
                };
                
                ws.onmessage = (event) => {
                    logMessage(`ğŸ“¨ Message: ${event.data}`);
                };
                
                ws.onerror = (event) => {
                    logMessage(`âŒ Error: ${JSON.stringify(event)}`);
                };
                
                ws.onclose = (event) => {
                    logMessage(`ğŸ”Œ Closed - Code: ${event.code}, Reason: ${event.reason || 'No reason'}, Clean: ${event.wasClean}`);
                };
                
            } catch (error) {
                logMessage(`âŒ Exception: ${error.message}`);
            }
        }
        
        function disconnect() {
            if (ws) {
                logMessage('ğŸ›‘ Disconnecting...');
                ws.close();
                ws = null;
            }
        }
    </script>
</body>
</html>
