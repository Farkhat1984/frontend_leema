server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    root   /usr/share/nginx/html;
    index  index.html index.htm;

    # ====================================
    # CLEAN URL STRUCTURE & REDIRECTS
    # ====================================

    # Root redirect to public (login)
    location = / {
        return 301 /public;
    }

    # Legacy redirects - old .html paths to clean URLs
    location = /index.html {
        return 301 /public;
    }

    location = /admin/index.html {
        return 301 /admin;
    }

    location = /shop/index.html {
        return 301 /shop;
    }

    location = /user/index.html {
        return 301 /user;
    }

    location = /user/dashboard.html {
        return 301 /user;
    }

    # Admin legacy paths
    location = /admin/admin-dashboard.html {
        return 301 /admin;
    }
    
    location = /admin/admin-products.html {
        return 301 /admin/products;
    }
    
    location = /admin/admin-shops.html {
        return 301 /admin/shops;
    }
    
    location = /admin/admin-users.html {
        return 301 /admin/users;
    }
    
    location = /admin/admin-settings.html {
        return 301 /admin/settings;
    }
    
    location = /admin/admin-analytics.html {
        return 301 /admin/analytics;
    }

    # ====================================
    # SECTION ROUTING (Clean URLs)
    # ====================================

    # Public section (login, auth, payments)
    location /public {
        try_files $uri $uri/index.html $uri.html /public/index.html;
    }

    # Admin section
    location /admin {
        try_files $uri $uri/index.html $uri.html /admin/index.html;
    }

    # Shop section
    location /shop {
        try_files $uri $uri/index.html $uri.html /shop/index.html;
    }

    # User section
    location /user {
        try_files $uri $uri/index.html $uri.html /user/index.html;
    }

    # ====================================
    # STATIC ASSETS
    # ====================================

    # Assets (CSS, JS, images) - strict matching
    location /assets {
        try_files $uri =404;
        access_log off;
    }

    # Favicon
    location = /favicon.ico {
        try_files /favicon.ico =404;
        access_log off;
    }

    # ====================================
    # FALLBACK
    # ====================================

    # Generic fallback - redirect unknown paths to login
    location / {
        try_files $uri $uri/index.html $uri.html @redirect_public;
    }

    location @redirect_public {
        return 302 /public;
    }

    # ====================================
    # CACHING RULES
    # ====================================

    # Cache static assets (1 year)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Don't cache HTML files
    location ~* \.html$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires 0;
    }

    # ====================================
    # ERROR PAGES
    # ====================================
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
